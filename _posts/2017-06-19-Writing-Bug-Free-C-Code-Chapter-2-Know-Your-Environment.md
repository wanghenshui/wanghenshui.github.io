---
layout: post
title: (译)Writing Bug Free C Code Chapter 2 Know Your Environment
categories: [language, translation]
tags : [c, gcc]
---
                                                                                                                                                                                                                                                                                  

\##### 这已经不是翻译了，这就是笔记了。

\##chapter 2： 了解你的工作环境
//blahblahblah(具体内容是了解你工作环境中的功能，特性)
​    在你的工作范围内尽可能成为专家
 接下来讨论所有工作环境中遇到的问题

\###2.1 C语言
无论你用啥编译器你都得彻底了解C语言工作环境

\#####2.1.1 数组操作符[]
//blahblahblahblah具体内容是数组操作符的功能，和指针的关系，咱认为是个陋习但是掌握还是不难的，随便翻一本C语言书都有的
// K&R §A7.3.1 

\#####2.1.2 结构体指针操作符 ->
//  K&R §A7.3.3 

\#####2.1.3 编译警告等级调高
// 这里具体指vs编译器，涉及到gcc就是-Wall 不多言

\#####2.1.4 编译时断言设计 ComplierAssert()
​    能放在编译期检测出来的bug就不要放在运行时

\#####2.1.5 变量声明
cdecl

\#####2.1.6 typedef

\#####2.1.7 命名空间 

\#####2.1.8 代码段变量
//与编译器实现有关，没什么意义。只是个访问权限的区别

\#####2.1.9 相邻字符串

\#####2.1.10 多参数…

\#####2.1.11 函数调用约定

\#####2.1.12 代码生成汇编
//以上两条都预编译器相关，基本没有用

\#####2.1.13 悬挂else问题

\#####2.1.14 strncpy 空间踩踏

\#####2.1.15 switch中default写对
你拼错编译器会解析成labal
//应该会有警告的，21世纪了朋友，这个应该是不对的
//这特么都什么经验

\#####2.1.16 逻辑运算与短路原则

\#####2.1.17 摩根定律
//数电中的布尔电路章节内容，基本功了。
以上就是复习了一下C语言

\###2.2 c预处理器

\#####2.2.1 宏以及宏可能遇到的问题
作用域以及原子性

\#####2.2.2 写有作用域的宏
do {}while(0)

\#####2.2.3 宏中的条件语句
为了避免悬挂else这种可能遇到的问题 直接匹配上就好了。

```
#define ODS(s) if (!bDebugging) {} else OutputDebugString(#s)
```

\#####2.2.4 宏像语句一样正常的使用，用分号或者语句块结尾

```
#define WinAssert(exp) if (!(exp)) {AssertError;} else
```

\#####2.2.5 循环宏
//不建议这么写，这样是上古语法了。LOOP（）ENDLOOP太二了

\#####2.2.6 数量宏
就是用宏把sizeof封装起来，经常在数组里见到

```
#define NUMSTATICELS(pArray) (sizeof(pArray)/sizeof(*pArray))
```

\#####2.2.7 预处理运算符#
字符串化和拼接技术

\#####2.2.8 字符匹配
和编译器实现有关。这都二十一世纪了，这段可以去掉了

\#####2.2.9 预处理器命令操纵预处理命令
宏开关

\#####以上也是C语言回顾 主要是一些奇技淫巧

\###2.3 编程难题
主要是一些实现上的坑

\#####2.3.1 2的平方 宏

```
#define ISPOWER2(x) (!((x)&((x)-1)))
```

位运算。见Hacker’s delight

\#####2.3.2 整数运算快
这与浮点数的设计有关，可以见MIT公开课编程范式 C语言部分

\#####2.3.3 交换两个数不用第三个变量
就是著名的坑跌异或异或异或。没有意义。会溢出（当然用三个变量也有溢出的可能）

\#####2.3.4 异或抵消锯齿？没看懂这部分
<http://www.duckware.com/bugfreec/chapter2.html#windows>

\#####2.3.5 ~0 可移植性强于0xffff

\#####2.3.6 y = -x 问题 补码

\#####2.3.7 1和2 的补码

Two’s complement negation as a macro

```
#define NEGATE(x) (((x)^~0)+1)
```

\###2.4 总结
个人总结
注意多参数的问题，快忘没了
宏的几个trick
还有2.3.4没看懂





---

